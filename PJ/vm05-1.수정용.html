<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŒë£Œ ìíŒê¸°</title>
    <style>
        #menu {
            width: 90%;
            border: 2px solid #333;
            margin: 20px auto;
            font-weight: 900;
            font-style: normal;
            text-align: center;
        }

        #menu article button {
            cursor: pointer;
        }

        .drink article {
            background-color: #fff;
            padding: 10px;
            text-align: center;
            margin: auto;
        }

        #wrapper {
            width: 750px;
            height: 1000px;
            padding: 10px;
            margin: 0 auto;
            border: 3px solid #333;
            text-align: center;
            float: left;
            background-color: #b5e984;
        }


        article {
            display: inline-block;
            border: 1px solid #fff;
            padding: 10px;
            margin-right: 30px;
        }

        #pocaA {
            margin-right: 50px;
            text-align: center;
        }

        #fantaA {
            margin-left: 70px;
        }

        #led {
            width: 90%;
            margin: 5px auto;
            padding: 10px;
            text-align: center;
            border: 3px solid #333;
        }

        #led input {
            text-align: right;
            padding: 5px;
            border-color: #333;
        }

        #output {
            width: 90%;
            height: 300px;
            padding: 10px;
            position: relative;
            text-align: right;
            display: inline-block;
            border-radius: 20px;
            margin: 10px auto;
            text-align: center;
            margin-bottom: -20px;
            margin-top: -20px;
        }

        #outDrinks {
            position: absolute;
            width: 400px;
            height: 400px;
            top: 2em;
            left: -1em;
            display: inline-block;
            background-image: url('out1.png');
            background-repeat: no-repeat;
        }


        #outDrink {
            margin-top: 45px;
            margin-left: -20px;
        }

        #led>label:nth-child(4) {
            margin-left: 3em;
        }

        #coinBox {
            width: 90%;
            height: 120px;
            padding: 10px;
            border-radius: 10px;
            margin: 10px auto;
            border: 3px solid #333;
            vertical-align: baseline;
        }

        #coins {
            display: inline-block;
            text-align: left;
            margin-top: 30px;
            float: left;
        }

        #inCoins {
            float: right;
            display: inline-block;
            width: 150px;
            padding: 1em 2em;
            border: 1px solid #999;
            background-color: #ddd;
            margin: 10px auto;
            border-radius: 10px;
        }

        #coins img {
            cursor: grab;
        }

        #slot {
            width: 100px;
            padding: 10px;
            background-color: #ddd;
            border: 10px solid #555;
            border-radius: 10px;
        }

        #outCoins {
            display: inline-block;
            margin-left: 3em;
        }

        #outCoins button {
            width: 70px;
            height: 70px;
            background-image: url('return.png');
            background-repeat: no-repeat;
            border-radius: 50%;
            border: 3px solid rgb(83, 82, 80);
            margin-bottom: 10px;
            cursor: pointer;
        }

        #inCoins input {
            width: 100px;
            padding: 5px 5px;
            border: 5px solid #999;
            background-color: #333;
            border-radius: 20px;
        }

        .fade-out {
            opacity: 0;
            transition: opacity 1s ease-out;
        }

        #baguni {
            width: 200px;
            display: flex;
            padding: 50px;
        }

        #adminPanel {
            width: 500px;
            height: 500px;
            display: none;
            border: 2px solid #000;
            padding: 1em;
            margin: 20px auto;
            background: #eee
        }

        .fieldset {
            margin-bottom: 1em
        }
    </style>
</head>

<body>
    <div id="wrapper">
        <h1>ìŒë£Œ ìíŒê¸°</h1>
        <div id="menu">
            <div class="drink">
                <article id="pocaA">
                    <img src="pocaOut.png" alt="í¬ì¹´ë¦¬">
                    <h3>ê°€ê²© : <span id="pocaPrice"></span>ì›</h3>
                    <button class="drinkBtn" id="poca">í¬ì¹´ë¦¬</button>
                </article>
                <article id="colaA">
                    <img src="colaOut.png" alt="ì½”ì¹´ì½œë¼">
                    <h3>ê°€ê²© : <span id="colaPrice"></span>ì›</h3>
                    <button class="drinkBtn" id="cola">ì½”ì¹´ì½œë¼</button>
                </article>
                <article id="fantaA">
                    <img src="fantaOut.png" alt="í™˜íƒ€">
                    <h3>ê°€ê²© : <span id="fantaPrice"></span>ì›</h3>
                    <button class="drinkBtn" id="fanta">í™˜íƒ€</button>
                </article>
            </div>
        </div>
        <div id="led">
            <label for="coin">ë™ì „ : </label>
            <input type="text" size="3" value="0" id="coin" placeholder="ë™ì „ ì…ë ¥">ì›
            <button id="inputMoney">ë™ì „ì…ë ¥</button>

            <label for="inMoney">
                íˆ¬ì…ê¸ˆì•¡ :
                <input type="text" readonly size="4" id="inMoney" value="0">ì›
            </label>

        </div>

        <div id="coinBox">
            <div id="coins">
                <img class="coin" draggable="true" src="coin500.png" id="coin500" alt="500ì›">
                <img class="coin" draggable="true" src="coin100.png" id="coin100" alt="100ì›">
                <img class="coin" draggable="true" src="coin50.png" id="coin50" alt="50ì›">
            </div>

            <div id="outCoins">
                <textarea rows="2" cols="10" id="exchangeCoins"></textarea>
                <button id="exchangCoins"></button>
            </div>

            <div id="inCoins">
                <div id="slot"></div>
            </div>
        </div>

        <div id="output">
            <div id="outDrinks">
                <div id="outDrink" style="visibility: hidden;">
                    <img class="imgDrink" src="pocaOut.png">
                </div>
            </div>
        </div>
    </div>

    <div id="baguni">
        <div id="list">
            <h2>êµ¬ë§¤ ëª©ë¡</h2>
            <div data-name="í¬ì¹´ë¦¬" style="display:none; text-align:center; margin:10px;">
                <img src="pocaOut.png" alt="í¬ì¹´ë¦¬" width="80" />
                <p>í¬ì¹´ë¦¬ x <span class="count">0</span></p>
            </div>

            <div data-name="ì½”ì¹´ì½œë¼" style="display:none; text-align:center; margin:10px;">
                <img src="colaOut.png" alt="ì½”ì¹´ì½œë¼" width="80" />
                <p>ì½”ì¹´ì½œë¼ x <span class="count">0</span></p>
            </div>

            <div data-name="í™˜íƒ€" style="display:none; text-align:center; margin:10px;">
                <img src="fantaOut.png" alt="í™˜íƒ€" width="80" />
                <p>í™˜íƒ€ x <span class="count">0</span></p>
            </div>
        </div>
    </div>

    <div id="adminPanel">
        <h2>ğŸ”§ ê´€ë¦¬ì íŒ¨ë„</h2>

        <fieldset>
            <legend><strong>ì¬ê³  ì„¤ì •</strong></legend>
            í¬ì¹´ë¦¬ ì¬ê³ : <input type="number" id="stockPoca" value="5" min="0" max="50"> ê°œ<br>
            ì½”ì¹´ì½œë¼ ì¬ê³ : <input type="number" id="stockCola" value="5" min="0" max="50"> ê°œ<br>
            í™˜íƒ€ ì¬ê³ : <input type="number" id="stockFanta" value="5" min="0" max="50"> ê°œ<br>
        </fieldset>

        <fieldset>
            <legend><strong>ê°€ê²© ì„¤ì •</strong></legend>
            í¬ì¹´ë¦¬ ê°€ê²©: <input type="number" id="pricePoca" value="700" min="100"><br>
            ì½”ì¹´ì½œë¼ ê°€ê²©: <input type="number" id="priceCola" value="800" min="100"><br>
            í™˜íƒ€ ê°€ê²©: <input type="number" id="priceFanta" value="900" min="100"><br>
        </fieldset>

        <button id="applyAdminChanges">ë³€ê²½ ì‚¬í•­ ì ìš©</button>
        <button id="closeAdmin">ë‹«ê¸°</button>
    </div>


    <div style="text-align:center; margin-top: 20px;">
        <button id="adminToggle">ğŸ”‘ê´€ë¦¬ì ëª¨ë“œ</button>
    </div>

    </div>
</body>
<script>
    document.addEventListener("DOMContentLoaded", () => {

        // ë©”ë‰´ì„ íƒ ì²˜ë¦¬

        // ì´ì…ë ¥í•œ ë™ì „
        let totInMoney = 0;

        // ìíŒê¸° íŒë§¤ê¸ˆì•¡ ëˆ„ì 
        let VMInMoney = 0;
        const POCA_PRICE = 700;
        const COLA_PRICE = 800;
        const FANTA_PRICE = 900;

        const drinkNames = ['í¬ì¹´ë¦¬', 'ì½”ì¹´ì½œë¼', 'í™˜íƒ€'];

        const drinkPrice = {
            "í¬ì¹´ë¦¬": 700,
            "ì½”ì¹´ì½œë¼": 800,
            "í™˜íƒ€": 900
        }

        const drinkImage = {
            "í¬ì¹´ë¦¬": 'pocaOut',
            "ì½”ì¹´ì½œë¼": 'colaOut',
            "í™˜íƒ€": 'fantaOut'
        }

        const soldoutImage = {
            "í¬ì¹´ë¦¬": 'pocaSoldout',
            "ì½”ì¹´ì½œë¼": 'colaSoldout',
            "í™˜íƒ€": 'fantaSoldout'
        }

        let drinkStock = {
            "í¬ì¹´ë¦¬": 5,
            "ì½”ì¹´ì½œë¼": 5,
            "í™˜íƒ€": 5
        };



        // í™”ë©´ì— ê°€ê²© í‘œì‹œ 
        document.querySelector("#pocaPrice").innerText = POCA_PRICE;
        document.querySelector("#colaPrice").innerText = COLA_PRICE;
        document.querySelector("#fantaPrice").innerText = FANTA_PRICE;

        // ìŒë£Œ ì¶œë ¥í™”ë©´ ì—°ê²°
        const $outDrinkImg = document.querySelector('#outDrink img');
        console.log('$outDrinkImg :' + $outDrinkImg.src)

        // ë™ì „ ë“œë¡­ì˜ì—­ ì—°ê²°
        const slot = document.querySelector("#slot");
        const coinBtns = document.querySelectorAll(".coin");

        // ë™ì „ ë“œë˜ê·¸ ì‹œì‘
        coinBtns.forEach(coinBtn => {
            addEventListener("dragstart", function (event) {
                event.dataTransfer.setData("text", event.target.id);
            });
        });

        // ë™ì „ ë“œë˜ê·¸ ì§„í–‰ ì¤‘...
        slot.addEventListener("dragover", (event) => {
            event.preventDefault();// ê°ê°ì˜ ê³ ìœ  ì´ë²¤íŠ¸ ë°©ì§€
        });

        // ë™ì „ ë“œë¡­ : ë™ì „ê°’ ë§Œí¼ ëˆ„ì , ë™ì „ì´ ì‚¬ë¼ì§
        slot.addEventListener("drop", (event) => {
            const coinId = event.dataTransfer.getData("text");
            console.log('==>' + coinId);
            const draggedCoin = document.getElementById(coinId);

            let coinValue = draggedCoin.getAttribute('alt');
            totInMoney += parseInt(
                coinValue.slice(0,
                    coinValue.lastIndexOf("ì›", coinValue)));
            document.querySelector("#inMoney").value = totInMoney;

            // ë™ì „ ë³µì‚¬
            const newCoin = draggedCoin.cloneNode(true);
            newCoin.style.position = "static";
            newCoin.style.zIndex = "1";
            slot.appendChild(newCoin);

            setTimeout(() => {
                newCoin.remove();
            }, 1000);
        })

        // ìŒë£Œ ë©”ë‰´ë¥¼ ì„ íƒí•˜ë©´ ê°ê° ë©”ë‰´ì— ë§ëŠ” ê¸°ëŠ¥ êµ¬í˜„
        const drinkBtns = document.querySelectorAll('.drinkBtn')
            .forEach(drinkBtn => {
                drinkBtn.addEventListener('click', function (event) {

                    // ìŒë£Œë©”ë‰´ í´ë¦­í•˜ë©´ í•´ì•¼í•  ì¼ì„ ê¸°ìˆ 
                    // ìŒë£Œë©”ë‰´ ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
                    let drinkName = event.target.textContent;

                    let drinkPrice = getPrice(drinkName);

                    // ì¬ê³  í™•ì¸
                    if (drinkStock[drinkName] <= 0) {
                        alert(`${drinkName}ê°€ ë§¤ì§„ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                        return;
                    }

                    // íˆ¬ì…í•œ ë™ì „ê³¼ ìŒë£Œê°€ê²©ì„ ë¹„êµí•˜ì—¬ ì»¤í”¼ íŒë§¤
                    if (totInMoney >= drinkPrice) {
                        VMInMoney += drinkPrice;
                        totInMoney -= drinkPrice;
                        document.querySelector("#inMoney").value = totInMoney;

                        // ì„ íƒí•œ ìŒë£Œ ë©”ë‰´ ì¶œë ¥
                        const imgSrc = outDrink(drinkName);
                        $outDrinkImg.src = imgSrc;
                        $outDrinkImg.style.visibility = 'visible';


                        // ì¬ê³  ê°ì†Œ
                        drinkStock[drinkName]--;

                        addOutDrink(drinkName);

                        updateStockDisplay();  // ì¬ê³  í˜„í™© í™”ë©´ ê°±ì‹  (ì•„ë˜ êµ¬í˜„)
                    } else {
                        alert('íˆ¬ì…ê¸ˆì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');
                    }
                });
            });


        // ë©”ë‰´ ì†Œì§„ ì‹œ ì†”ë“œì•„ì›ƒ ì´ë¯¸ì§€ ì¶œë ¥
        function updateStockDisplay() {
            for (let name of drinkNames) {
                if (drinkStock[name] <= 0) {
                    const imgEl = document.querySelector(`img[alt="${name}"]`);
                    imgEl.src = `${soldoutImage[name]}.png`;
                    imgEl.style.cursor = "not-allowed";

                    // í´ë¦­ ì´ë²¤íŠ¸ ì œê±°
                    const newImgEl = imgEl.cloneNode(true);
                    imgEl.parentNode.replaceChild(newImgEl, imgEl);
                }
            }
        }

        function outDrink(drinkName) {
            return `${drinkImage[drinkName]}.png`;
        }

        function getPrice(drinkName) {
            return drinkPrice[drinkName];
        }


        // ë™ì „ì…ë ¥ ì²˜ë¦¬
        document.querySelector('#inputMoney').
            addEventListener('click', function () {

                // ë™ì „ ì…ë ¥ ì²˜ë¦¬
                let coin = document.querySelector("#coin").value;

                // ë™ì „ ëˆ„ì 
                totInMoney += parseInt(coin);

                // ë™ì „ ëˆ„ì  ì¶œë ¥
                document.querySelector("#inMoney").value = totInMoney;

            });

        document.querySelector("#exchangCoins").addEventListener("click", () => {
            let coins = document.querySelector("#inMoney").value;
            document.querySelector("#inMoney").value = 0;

            document.querySelector("#exchangeCoins").innerHTML = `${coins}`;
            totInMoney = 0;
        });
    });


    // êµ¬ë§¤ ëª©ë¡


    const purchasedCounts = {
        "í¬ì¹´ë¦¬": 0,
        "ì½”ì¹´ì½œë¼": 0,
        "í™˜íƒ€": 0
    };

    function addOutDrink(drinkName) {
        purchasedCounts[drinkName]++;

        // êµ¬ë§¤ëª©ë¡ ì˜ì—­ì—ì„œ í•´ë‹¹ ìŒë£Œ ì„ íƒ
        const drinkDiv = document.querySelector(`#baguni div[data-name="${drinkName}"]`);

        if (drinkDiv.style.display === "none") {
            drinkDiv.style.display = "inline-block";  // ì´ë¯¸ì§€ ë³´ì´ê¸°
        }

        // ê°¯ìˆ˜ ëˆ„ì 
        const countSpan = drinkDiv.querySelector(".count");
        countSpan.textContent = purchasedCounts[drinkName];
    }



    document.addEventListener("DOMContentLoaded", () => {
    let isAdmin = false;
    let totInMoney = 0;
    let VMInMoney = 0;

    const drinkNames = ['í¬ì¹´ë¦¬', 'ì½”ì¹´ì½œë¼', 'í™˜íƒ€'];

    let drinkPrice = {
        "í¬ì¹´ë¦¬": 700,
        "ì½”ì¹´ì½œë¼": 800,
        "í™˜íƒ€": 900
    };

    const drinkImage = {
        "í¬ì¹´ë¦¬": 'pocaOut',
        "ì½”ì¹´ì½œë¼": 'colaOut',
        "í™˜íƒ€": 'fantaOut'
    };

    const soldoutImage = {
        "í¬ì¹´ë¦¬": 'pocaSoldout',
        "ì½”ì¹´ì½œë¼": 'colaSoldout',
        "í™˜íƒ€": 'fantaSoldout'
    };

    let drinkStock = {
        "í¬ì¹´ë¦¬": 5,
        "ì½”ì¹´ì½œë¼": 5,
        "í™˜íƒ€": 5
    };

    const purchasedCounts = {
        "í¬ì¹´ë¦¬": 0,
        "ì½”ì¹´ì½œë¼": 0,
        "í™˜íƒ€": 0
    };

    const $outDrinkImg = document.querySelector('#outDrink img');

    function getButtonId(name) {
        switch (name) {
            case "í¬ì¹´ë¦¬": return "poca";
            case "ì½”ì¹´ì½œë¼": return "cola";
            case "í™˜íƒ€": return "fanta";
        }
    }

    function updateStockDisplay() {
        for (let name of drinkNames) {
            const imgEl = document.querySelector(`img[alt="${name}"]`);
            const btnEl = document.getElementById(getButtonId(name));

            if (drinkStock[name] <= 0) {
                imgEl.src = `${soldoutImage[name]}.png`;
                imgEl.style.cursor = "not-allowed";
                btnEl.disabled = true;
            } else {
                imgEl.src = `${drinkImage[name]}.png`;
                imgEl.style.cursor = "pointer";
                btnEl.disabled = false;
            }
        }
    }

    function addOutDrink(drinkName) {
        purchasedCounts[drinkName]++;
        const drinkDiv = document.querySelector(`#baguni div[data-name="${drinkName}"]`);
        if (drinkDiv.style.display === "none") {
            drinkDiv.style.display = "inline-block";
        }
        drinkDiv.querySelector(".count").textContent = purchasedCounts[drinkName];
    }

    // ê´€ë¦¬ì í† ê¸€
    document.querySelector("#adminToggle").addEventListener("click", () => {
        const pw = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
        if (pw === "1234") {
            isAdmin = true;
            document.querySelector("#adminPanel").style.display = "block";

            document.querySelector("#stockPoca").value = drinkStock["í¬ì¹´ë¦¬"];
            document.querySelector("#stockCola").value = drinkStock["ì½”ì¹´ì½œë¼"];
            document.querySelector("#stockFanta").value = drinkStock["í™˜íƒ€"];

            document.querySelector("#pricePoca").value = drinkPrice["í¬ì¹´ë¦¬"];
            document.querySelector("#priceCola").value = drinkPrice["ì½”ì¹´ì½œë¼"];
            document.querySelector("#priceFanta").value = drinkPrice["í™˜íƒ€"];
        } else {
            alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
        }
    });

    document.querySelector("#closeAdmin").addEventListener("click", () => {
        isAdmin = false;
        document.querySelector("#adminPanel").style.display = "none";
    });

    document.querySelector("#applyAdminChanges").addEventListener("click", () => {
        if (!isAdmin) return;

        drinkStock["í¬ì¹´ë¦¬"] = parseInt(document.querySelector("#stockPoca").value);
        drinkStock["ì½”ì¹´ì½œë¼"] = parseInt(document.querySelector("#stockCola").value);
        drinkStock["í™˜íƒ€"] = parseInt(document.querySelector("#stockFanta").value);

        drinkPrice["í¬ì¹´ë¦¬"] = parseInt(document.querySelector("#pricePoca").value);
        drinkPrice["ì½”ì¹´ì½œë¼"] = parseInt(document.querySelector("#priceCola").value);
        drinkPrice["í™˜íƒ€"] = parseInt(document.querySelector("#priceFanta").value);

        document.querySelector("#pocaPrice").innerText = drinkPrice["í¬ì¹´ë¦¬"];
        document.querySelector("#colaPrice").innerText = drinkPrice["ì½”ì¹´ì½œë¼"];
        document.querySelector("#fantaPrice").innerText = drinkPrice["í™˜íƒ€"];

        updateStockDisplay();
        alert("ë³€ê²½ ì‚¬í•­ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.");
    });


});

</script>
